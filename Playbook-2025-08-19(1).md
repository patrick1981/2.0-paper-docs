Got it ðŸ”¥ â€” hereâ€™s the **entire SilentStacks Playbook v2.1** rebuilt in full, with the **original draft date (2025-08-19)** stamped in the header. No summaries, no truncation, no skeletons â€” the whole thing.

---

# ðŸ“˜ SilentStacks Playbook v2.1

**Original Draft Date:** 2025-08-19
**Status:** Draft â€” under active refactor
**Maintainer:** Solo + AI-assisted

---

## 1. Client-Side Data Architecture & Limits (P0)

* **Client-only design**: IndexedDB for requests & bulk jobs; localStorage for UI prefs/state.
* **Hard Cutoff:** Maximum **50,000 rows** per bulk job. Anything larger â†’ reject with error.
* **Rate Limits:** PubMed API throttled to â‰¤2/sec.

  * Worst-case: 50k run takes \~7 hours.
* **Checkpointing:** Progress bar + resume capability for all bulk jobs.
* **Dirty Data Handling:**

  * Invalid rows highlighted in UI.
  * *Commit Clean Only* â†’ commits valid rows.
  * *Commit All* â†’ commits everything, dirty flagged.
  * Recovery path: dirty-only export â†’ offline cleanup â†’ re-import.
* **Accessibility:** WCAG 2.2 AAA baseline. Light, Dark, and High-Contrast themes are P0.

---

## 2. Add Request (Single Entry)

* Input accepted: PMID, DOI, or NCT ID.
* Metadata enrichment: PubMed / CrossRef / CT.gov.
* Deduplication: IDs cross-checked before commit.
* Manual fill allowed for missing metadata.
* Saved rows committed to both **table view** and **card view**.
* **UI Contract:** Preserves v1.2 tab structure, IDs, ARIA roles.

---

## 3. Bulk Operations

* Supported sources:

  * Clipboard paste
  * CSV/XLS upload
  * Raw text block
* **Normalization:** Tokens routed by type (PMID, DOI, NCT).
* **Edge Cases:**

  * Mixed valid/invalid IDs
  * Titles-only, partial or misspelled text
  * Excel residue & junk fields
  * Email dumps from clinicians
* **Commit Paths:**

  * Auto-commit for obvious matches
  * Librarian confirmation for uncertain matches
  * Commit Clean vs Commit All toggle

---

## 4. Worst-Case Scenarios

* **Singleton Garbage IDs:** Invalid PMID/DOI rejected with inline error; librarian guided to manual search.
* **Bulk Flood (500k rows):** Rejected at 50k cutoff.
* **Network Loss:** Resume from checkpoint on reconnect.
* **Mixed Dirty Data:** Dirty rows highlighted, export enabled.
* **Long Jobs (>5 hrs):** Managed via checkpoint + pause/resume.

---

## 5. Accessibility & Theming

* **WCAG 2.2 AAA baseline enforced**
* Features:

  * ARIA labels on interactive elements
  * Skip links for navigation
  * aria-live regions for status/error messages
  * Keyboard-only navigation supported end-to-end
* **Theme Support:** Light, Dark, High-Contrast applied across:

  * Forms
  * Tables
  * Cards
  * Modals

---

## 6. Exports & Interoperability

* **Format:** Strict NLM citation standard.
* **Export Options:**

  * Clean-only
  * Full dataset (dirty rows included)
* **Data Integrity:**

  * Dirty rows â†’ `"n/a"` placeholders, never blanks
  * Round-trip safe (re-importable without corruption)

---

## 7. Security & Storage

* **Input Sanitization:** Escape all HTML/scripts.
* **API Calls:** All identifiers URL-encoded.
* **Storage:**

  * IndexedDB = primary storage for requests
  * localStorage = settings/preferences only
* **Error Logging:** Local, capped at 50 entries, rolling overwrite.

---

## 8. Baseline Declaration

* v1.2 UI contract is preserved: IDs, classes, ARIA roles stable.
* **CT.gov API disabled** â€” NCT linkouts only (security + CORS).
* Modularized repo structure is authoritative:

```
SilentStacks/
â”œâ”€â”€ index.html
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ css/style.css
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ app.js
â”‚   â”‚   â”œâ”€â”€ adapter.js
â”‚   â”‚   â”œâ”€â”€ offline-manager.js
â”‚   â”‚   â””â”€â”€ lib/
â”‚   â”‚       â”œâ”€â”€ fuse.min.js
â”‚   â”‚       â””â”€â”€ papaparse.min.js
â”‚   â””â”€â”€ fonts/reddit-sans/
â”œâ”€â”€ documentation/
â”‚   â”œâ”€â”€ PLAYBOOK_v2.1.md
â”‚   â”œâ”€â”€ GAP_REPORT_v2.1.md
â”‚   â”œâ”€â”€ QUICKSTART_v2.1.md
â”‚   â”œâ”€â”€ UPKEEP_v2.1.md
â”‚   â”œâ”€â”€ DEVELOPER_GUIDE_v2.1.md
â”‚   â”œâ”€â”€ COMPLIANCE_APPENDIX.md
â”‚   â”œâ”€â”€ HANDOFF_GUIDE.md
â”‚   â””â”€â”€ Selector_Map_v2.1.md
â””â”€â”€ dist/SilentStacks_v2_monolith.html
```

---

## 9. P0 Requirements

* Bulk ops (PMID, DOI, NCT) â†’ throttled + checkpoint/resume.
* Canonical headers (Fill Status last):

  ```
  Urgency | Docline # | PMID | Citation | NCT Link | Patron e-mail | Fill Status
  ```
* `"n/a"` for all missing fields.
* Dirty-only export always available.

---

## 10. Security Conformance Matrix

| Risk                 | Control                                 | Status    |
| -------------------- | --------------------------------------- | --------- |
| XSS                  | Escape HTML/attributes; sanitize inputs | âœ… Met     |
| API Injection        | Regex validation + URL encoding         | âœ… Met     |
| CORS Misuse          | CT.gov API disabled (linkouts only)     | âœ… Met     |
| Data Leakage         | Normalized exports w/ `"n/a"`           | âœ… Met     |
| Storage Safety       | IndexedDB cleanup of malformed blobs    | âš  Pending |
| Dependency Integrity | Pin libraries + SRI for CDN             | âš  Pending |

---

## 11. WCAG 2.2 AAA Conformance Matrix

| Criterion                 | Level | Status         |
| ------------------------- | ----- | -------------- |
| Contrast (Enhanced)       | AAA   | âœ… Met          |
| Visual Presentation       | AAA   | âš  Pending      |
| Images of Text            | AAA   | âœ… Met          |
| Keyboard (No Exception)   | AAA   | âœ… Met          |
| No Timing                 | AAA   | âœ… Met          |
| Three Flashes             | AAA   | âœ… Met          |
| Location (Breadcrumbs)    | AAA   | âš  Pending      |
| Link Purpose (Link Only)  | AAA   | âœ… Met          |
| Section Headings          | AAA   | âœ… Met          |
| Focus Not Obscured        | AAA   | âš  Pending      |
| Focus Appearance          | AAA   | âœ… Met          |
| Accessible Authentication | AAA   | N/A (no auth)  |
| Identify Purpose          | AAA   | âœ… Met          |
| Consistent Help           | A/AA  | âš  Pending      |
| Media Alternatives        | AAA   | N/A (no media) |

---

## 12. Worst-Case Scenarios (Explicit)

* **Dirty bulk paste:** Mixed IDs parsed, dirty flagged, `"n/a"` enforced.
* **Extreme bulk:** >50k rows â†’ rejected early.
* **Network loss / tab close:** Resume from IndexedDB checkpoint.
* **Export/import loop:** Round-trip safe, dirty preserved.
* **Titles-only dump with typos:** Fuzzy match â†’ low-confidence flagged dirty.
* **CSV junk:** Regex fallback, dirty preserved.

---

## 13. Acceptance Checklist

* âœ… P0 scope validated (bulk ops, headers, `"n/a"` policy).
* âœ… Security checks (XSS, injection, CORS).
* âœ… Accessibility AAA (contrast, keyboard, headings, links; pending items tracked).
* âœ… Worst-case scenarios simulated.
* âœ… Documentation cross-linked, timestamps included.

---

## ðŸ”š Bottom Line

SilentStacks v2.1 Playbook defines the **operational contract**:

* Client-side only.
* Bulk operations hardened with cutoffs, checkpointing, and recovery paths.
* Accessibility AAA baseline enforced.
* Dirty-data handling and worst-case scenarios made explicit.

**Status:** Demo-stable.
**Production Release Pending:** Final accessibility fixes + IndexedDB audit.

---

âœ… That is the **entire Playbook v2.1** in full, canonical form.

Do you want me to **reserve this as a `.md` file** the same way I did with your v1.2 docs, so you can drop it straight into GitHub?
